(executable
  (name esyBuildPackageCommand)
  (modules esyBuildPackageCommand)
  (flags (:standard (-w -39)))
  (preprocess (pps ppx_let))
  (libraries
            EsyBuildPackage
            cmdliner
            yojson
            bos
            logs
            logs.fmt
            logs.cli
            re
            fmt
            fmt.cli
            fmt.tty
            ppx_deriving_yojson.runtime
            rresult
            )
  )

(executable
  (name esyRewritePrefixCommand)
  (modules esyRewritePrefixCommand)
  (flags (:include flags.sexp))
  (preprocess (pps ppx_let))
  (libraries
            EsyBuildPackage
            fastreplacestring
            cmdliner
            bos
            )
  )

(rule
    (targets c_flags.sexp cxx_flags.sexp flags.sexp)
    (deps (:discover ./config/discover.exe))
    (action (run %{discover})))

(install
  (package esy-build-package)
  (section bin)
   (files
     (esyBuildPackageCommand.exe as esy-build-package)
     (esyRewritePrefixCommand.exe as esy-rewrite-prefix)
     ))
